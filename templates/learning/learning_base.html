<!-- templates/learning/learning_base.html -->
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}IGCSE Learning Platform{% endblock %}</title>

    <!-- Local Tailwind -->
    <link rel="stylesheet" href="{% static 'css/tailwind.css' %}">
    <!-- Educator dashboard overrides -->
    <link rel="stylesheet" href="{% static 'css/educator_dashboard.css' %}">

    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- ---------------- Navbar ---------------- -->
    <nav class="module-navbar bg-white shadow-md rounded-md">
        <div class="container mx-auto flex justify-between items-center p-4">

            <!-- Brand / Dashboard Link -->
            <a href="{% url 'cam_igcse:dashboard' %}" class="nav-brand font-bold text-blue-700 flex items-center">
                < IGCSE Dashboard
            </a>

            <!-- Burger for Mobile -->
            <div class="burger md:hidden flex flex-col gap-1 cursor-pointer">
                <div class="w-6 h-0.5 bg-gray-700"></div>
                <div class="w-6 h-0.5 bg-gray-700"></div>
                <div class="w-6 h-0.5 bg-gray-700"></div>
            </div>

            <!-- Nav Links -->
            <ul class="nav-links hidden md:flex gap-1">
                {% for m in all_modules %}
                    <li class="nav-item relative group">
                        <a href="{% url 'cam_igcse:module_detail' m.slug %}"
                           class="px-4 py-2 rounded-lg text-gray-700 hover:bg-blue-500 hover:text-white transition duration-150
                           {% if module and m.slug == module.slug %}bg-blue-100 text-blue-700 font-bold{% endif %}">
                            {{ m.name }}
                        </a>

                        {% if m.topics.all %}
                            <ul class="dropdown absolute top-full left-0 mt-0.5
                                       bg-white border border-gray-200 shadow-xl rounded-lg
                                       min-w-[250px] opacity-0 invisible group-hover:visible group-hover:opacity-100 transition duration-300 ease-in-out z-30">
                                {% for topic in m.topics.all %}
                                    <li>
                                        <a href="{% url 'cam_igcse:topic_detail' m.slug topic.slug %}"
                                           class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-500 hover:text-white
                                           {% if forloop.first %}rounded-t-lg{% endif %}
                                           {% if forloop.last %}rounded-b-lg{% endif %}
                                           {% if topic.slug == request.resolver_match.kwargs.topic_slug %}bg-blue-50 text-blue-700 font-bold{% endif %}">
                                            {{ topic.title }}
                                        </a>
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
    </nav>

    <!-- Mobile menu -->
    <ul class="mobile-nav-links flex flex-col hidden bg-white w-full p-4 space-y-2 md:hidden">
        {% for m in all_modules %}
            <li>
                <a href="{% url 'cam_igcse:module_detail' m.slug %}" class="block px-3 py-2 {% if module and m.slug == module.slug %}font-bold text-blue-700{% endif %}">
                    {{ m.name }}
                </a>
            </li>
        {% endfor %}
    </ul>

    <!-- ---------------- Main Content ---------------- -->
    <main id="igcse-main-dashboard" class="py-6">
        <div class="container mx-auto">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- ---------------- JS ---------------- -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const burger = document.querySelector(".burger");
            const mobileMenu = document.querySelector(".mobile-nav-links");
            burger.addEventListener("click", () => {
                mobileMenu.classList.toggle("hidden");
            });
        });
    </script>

    {% block extra_js %}{% endblock %}
<footer class="site-footer mt-12 py-4 border-t border-gray-200 bg-white text-center text-gray-500 text-sm">
        Â© Archie and the Wombat
    </footer>
</body>
</html>
